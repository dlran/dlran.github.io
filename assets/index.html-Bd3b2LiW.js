import{_ as i,c as a,a as e,o as n}from"./app-BAWHrzcv.js";const l={};function h(t,s){return n(),a("div",null,s[0]||(s[0]=[e(`<p>本教程为 OpenVPN 配置基于用户名和密码的客户端认证方式，适用于服务端和客户端均为 Linux 系统的环境。</p><hr><h2 id="步骤-1-创建用户认证脚本-checkpsw-sh" tabindex="-1"><a class="header-anchor" href="#步骤-1-创建用户认证脚本-checkpsw-sh"><span>步骤 1：创建用户认证脚本 <code>checkpsw.sh</code></span></a></h2><p>OpenVPN 需要使用一个脚本来验证用户名和密码。我们可以从官方源下载这个脚本：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 下载认证脚本</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">wget</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">http://openvpn.se/files/other/checkpsw.sh</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -O</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/openvpn/checkpsw.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 添加执行权限</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">chmod</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 755</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/openvpn/checkpsw.sh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="步骤-2-配置用户名和密码文件" tabindex="-1"><a class="header-anchor" href="#步骤-2-配置用户名和密码文件"><span>步骤 2：配置用户名和密码文件</span></a></h2><p>该文件中每一行包含一个用户名和对应的密码，用空格分隔：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">jerry passwd1</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/openvpn/psw-file</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>你可以根据需要添加多个用户，每个用户占一行。</p><hr><h2 id="步骤-3-修改-openvpn-服务端配置文件" tabindex="-1"><a class="header-anchor" href="#步骤-3-修改-openvpn-服务端配置文件"><span>步骤 3：修改 OpenVPN 服务端配置文件</span></a></h2><p>在 <code>server.conf</code> 的末尾添加以下内容，启用脚本认证机制：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 配置 OpenVPN 服务端配置文件路径</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">file</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/etc/openvpn/server.conf</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">cat</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;&lt;</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">EOF</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;&gt;</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $file</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">script-security 3</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">auth-user-pass-verify /etc/openvpn/checkpsw.sh via-env    # 指定用户认证脚本</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">username-as-common-name</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">verify-client-cert none</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>解释：</p><ul><li><code>script-security 3</code>：允许调用外部脚本。</li><li><code>auth-user-pass-verify</code>：指定认证脚本路径。</li><li><code>username-as-common-name</code>：将用户名作为 common name。</li><li><code>verify-client-cert none</code>：关闭客户端证书验证，仅使用用户名密码。</li></ul><hr><h2 id="步骤-4-修改客户端配置文件" tabindex="-1"><a class="header-anchor" href="#步骤-4-修改客户端配置文件"><span>步骤 4：修改客户端配置文件</span></a></h2><p>我们为用户 <code>jerry</code> 生成客户端配置，并修改其 <code>.ovpn</code> 文件，注释掉证书相关配置，并启用用户名密码输入：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 创建客户端配置（假设你已有该脚本）</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sh</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/openvpn/client/add_ovpn_user.sh</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> jerry</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 客户端配置文件路径</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">clientCnf</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/etc/openvpn/client/keys/jerry/jerry.ovpn</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 注释掉证书文件配置</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sed</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -i</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">s/cert client.crt/;cert client.crt/g</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $clientCnf</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sed</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -i</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">s/key client.key/;key client.key/g</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $clientCnf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 添加用户名密码登录支持</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">auth-user-pass</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;&gt;</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $clientCnf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="完成" tabindex="-1"><a class="header-anchor" href="#完成"><span>完成！</span></a></h2><p>现在，客户端连接时会弹出用户名和密码输入提示，服务端通过 <code>checkpsw.sh</code> 脚本与 <code>psw-file</code> 文件进行验证，无需使用客户端证书登录。</p><p>可以根据实际需要扩展用户列表、增强脚本安全性或接入外部认证系统。</p>`,24)]))}const k=i(l,[["render",h]]),d=JSON.parse('{"path":"/article/04c7EubA/","title":"Linux | OpenVPN 配置用户名密码认证","lang":"zh-CN","frontmatter":{"title":"Linux | OpenVPN 配置用户名密码认证","tags":["Linux"],"categories":null,"createTime":"2021/04/30 03:15:08","permalink":"/article/04c7EubA/"},"readingTime":{"minutes":1.76,"words":528},"git":{"updatedTime":1749957276000,"changelog":[{"hash":"13186debee90c844663d33582e6bd52fe59a5bfc","time":1749957276000,"email":"rr@jjyy.bb","author":"rr","message":"initial"}]},"filePathRelative":"Operations/OpenVPN.md","headers":[],"categoryList":[{"id":"456d0d","sort":10000,"name":"Operations"}]}');export{k as comp,d as data};
